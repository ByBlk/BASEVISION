local IplList = {
    {
        name = "Criminal Enterprise",
        dlc = true,
        tp = vector3(850.32891845703, -3001.0517578125, -49.999843597412),
    },
    {
        name = "The Contract Studio",
        dlc = true,
        tp = vector3(-999.20227050781, -66.02400970459, -100.00311279297),
    },
    {
        name = "Bikers Clubhouse 1",
        dlc = true,
        tp = vector3(1107.04, -3157.399, -37.51859),
    },
    {
        name = "Bikers Clubhouse 2",
        dlc = true,
        tp = vector3(998.4809, -3164.711, -38.90733),
    },
    {
        name = "Bikers Cocaine",
        dlc = true,
        tp = vector3(1093.6, -3196.6, -38.99841),
    },
    {
        name = "Bikers Counterfeit cash factory",
        dlc = true,
        tp = vector3(1121.897, -3195.338, -40.4025),
    },
    {
        name = "Bikers Document forgery",
        dlc = true,
        tp = vector3(1165.0, -3196.6, -39.01306),
    },
    {
        name = "Bikers Meth",
        dlc = true,
        tp = vector3(1009.5, -3196.6, -38.99682),
    },
    {
        name = "Bikers Weed farm",
        dlc = true,
        tp = vector3(1051.491, -3196.536, -39.14842),
    },
    {
        name = "Casino Arcade",
        tp = vector3(2730.0, -380.0, -49.0),
        dlc = true
    },
    {
        name = "Cayo Club",
        tp = vector3(1550.0, 250.0, -48.0),
        dlc = true
    },
    {
        name = "IAA Facility",
        tp = vector3(2155.07, 2920.88, -62.9),
        dlc = true
    },
    {
        name = "IAA Server Room",
        tp = vector3(2154.85, 2921.07, -82.08),
        dlc = true
    },
    {
        name = "Doomsday",
        tp = vector3(460.6, 4815.69, -60.0),
        dlc = true
    },
    {
        name = "Doomsday Bunker",
        tp = vector3(532.79187011719, 5914.458984375, -159.08006286621),
        dlc = true
    },
    {
        name = "Aircraft",
        tp = vector3(3085.1760253906, -4688.5556640625, 26.251892089844),
        dlc = true
    },
    {
        name = "Plane Hangar",
        tp = vector3(-1267.0 -3013.135 -49.5),
        dlc = true
    },
    {
        name = "Import/Export",
        tp = vector3(994.5925, -3002.594, -39.64699),
        dlc = true
    },
    {
        name = "CEO VEHICLES SHOP",
        tp = vector3(730.63916015625, -2993.2373046875, -38.999904632568),
        dlc = true
    },
    {
        name = "Coroner",
        tp = vector3(240.97831726074, -1366.2081298828, 38.534381866455),
    },
    {
        name = "Bunker",
        tp = vector3(901.29949951172, -3223.8515625, -99.25749206543),
    },
    {
        name = "Cinema",
        tp = vector3(-1426.8258056641, -256.29141235352, 15.782796859741),
    },
    {
        name = "TunerGarage",
        tp = vector3(-1350.0, 160.0, -100.0),
        dlc = true
    },
    {
        name = "TunerMethLab",
        tp = vector3(981.9999, -143.0, -50.0),
        dlc = true
    },
    {
        name = "TunerMeetup",
        tp = vector3(-2000.0, 1113.211, -25.36243),
        dlc = true
    },
    {
        name = "MpSecurityGarage",
        tp = vector3(-1071.4387, -77.033875, -93.525505),
        dlc = true
    },
    {
        name = "MpSecurityMusicRoofTop",
        tp = vector3(-592.6896, 273.1052, 116.302444),
        dlc = true
    },
    {
        name = "MpSecurityStudio",
        tp = vector3(-1000.7252, -70.559875, -98.10669),
        dlc = true
    },
    {
        name = "MpSecurityBillboards",
        tp = vector3(-592.6896, 273.1052, 116.302444),
        dlc = true
    },
    {
        name = "MpSecurityOffice1",
        tp = vector3(-1021.86084, -427.74564, 68.95764),
        dlc = true
    },
    {
        name = "MpSecurityOffice2",
        tp = vector3(383.4156, -59.878227, 108.4595),
        dlc = true
    },
    {
        name = "MpSecurityOffice3",
        tp = vector3(-1004.23035, -761.2084, 66.99069),
        dlc = true
    },
    {
        name = "MpSecurityOffice4",
        tp = vector3(-587.87213, -716.84937, 118.10156),
        dlc = true
    },
    {
        name = "CriminalEnterpriseSmeonFix",
        tp = vector3(-50.2248, -1098.8325, 26.049742),
        dlc = true
    },
    {
        name = "CriminalEnterpriseVehicleWarehouse",
        tp = vector3(800.13696, -3001.4297, -65.14074),
        dlc = true
    },
    {
        name = "CriminalEnterpriseWarehouse",
        tp = vector3(849.1047, -3000.209, -45.974354),
        dlc = true
    },
    {
        name = "DrugWarsFreakshop",
        tp = vector3(570.9713, -420.0727, -70.000),
        dlc = true
    },
    {
        name = "DrugWarsGarage",
        tp = vector3(519.2477, -2618.788, -50.000),
        dlc = true
    },
    {
        name = "DrugWarsLab",
        tp = vector3(483.4252, -2625.071, -50.000),
        dlc = true
    },
    {
        name = "MercenariesClub",
        tp = vector3(1202.407, -3251.251, -50.000),
        dlc = true
    },
    {
        name = "MercenariesLab",
        tp = vector3(-1916.119, 3749.719, -100.000),
        dlc = true
    },
    {
        name = "ChopShopCargoShip",
        tp = vector3(-344.4349, -4062.832, 17.000),
        dlc = true
    },
    {
        name = "ChopShopCartelGarage",
        tp = vector3(1220.133, -2277.844, -50.000),
        dlc = true
    },
    {
        name = "ChopShopLifeguard",
        tp = vector3(-1488.153, -1021.166, 5.000),
        dlc = true
    }
}
local selectedIPL = {}
local lastPos = nil
local tpIPL = false
local freezObject = false

local function SpawnProps(obj, freeze)
    local playerPed = VFW.PlayerData.ped
    local coords, forward = GetEntityCoords(playerPed), GetEntityForwardVector(playerPed)
    local objCoords = coords + forward * 2.5
    local heading = GetEntityHeading(playerPed)
    local placed = false
    local objS = CreateObject(GetHashKey(obj), objCoords.x, objCoords.y, objCoords.z, true, true, true)

    SetEntityHeading(objS, heading)
    PlaceObjectOnGroundProperly(objS)
    SetEntityAlpha(objS, 170, false)
    SetEntityCollision(objS, false, true)

    while not placed do
        coords, forward = GetEntityCoords(playerPed), GetEntityForwardVector(playerPed)
        objCoords = coords + forward * 2.5
        SetEntityCoords(objS, objCoords.x, objCoords.y, objCoords.z, false, false, false, true)
        PlaceObjectOnGroundProperly(objS)

        if IsControlPressed(0, 190) then
            heading = heading + 0.5
        elseif IsControlPressed(0, 189) then
            heading = heading - 0.5
        end

        SetEntityHeading(objS, heading)

        VFW.ShowHelpNotification("Appuyez sur ~INPUT_CONTEXT~ pour placer l'objet\n~INPUT_FRONTEND_LEFT~ ou ~INPUT_FRONTEND_RIGHT~ Pour faire pivoter l'objet")

        if IsControlJustPressed(0, 38) then
            placed = true
        end

        DisableControlAction(0, 22, true)

        Wait(0)
    end

    ResetEntityAlpha(objS)
    SetEntityCollision(objS, true, true)
    FreezeEntityPosition(objS, freeze)
    SetNetworkIdCanMigrate(NetworkGetNetworkIdFromEntity(objS), true)

    TriggerServerEvent("vfw:staff:saveObject", {
        name = obj,
        id = objS,
        geneartedId = NetworkGetNetworkIdFromEntity(objS),
    })
end

function StaffMenu.BuildEventsMenu()
    xmenu.items(StaffMenu.events, function()
        addButton("IPL", { rightIcon = "chevron" }, {
            onSelected = function()
                StaffMenu.BuildEventsIpsMenu()
            end
        }, StaffMenu.eventsIpl)

        addButton("MAP EDITOR", { rightIcon = "chevron" }, {
            onSelected = function()
                StaffMenu.BuildMapEditorMenu()
            end
        }, StaffMenu.mapeditor)
    end)
end

function StaffMenu.BuildEventsIpsMenu()
    xmenu.items(StaffMenu.eventsIpl, function()
        for _, v in pairs(IplList) do
            addButton(string.upper(v.name), { rightIcon = "chevron" }, {
                onSelected = function()
                    selectedIPL = v
                    StaffMenu.BuildEventsIplSelectMenu()
                end
            }, StaffMenu.eventsIplSelect)
        end
    end)
end

function StaffMenu.BuildEventsIplSelectMenu()
    xmenu.items(StaffMenu.eventsIplSelect, function()
        if selectedIPL and selectedIPL.name then
            addSeparator("Nom : " .. selectedIPL.name)

            if not tpIPL then
                addButton("SE TELEPORTER", { rightIcon = "chevron" }, {
                    onSelected = function()
                        lastPos = GetEntityCoords(VFW.PlayerData.ped)
                        tpIPL = true
                        SetPedCoordsKeepVehicle(VFW.PlayerData.ped, selectedIPL.tp.x, selectedIPL.tp.y, selectedIPL.tp.z)
                        StaffMenu.BuildEventsIplSelectMenu()
                    end
                })
            else
                addButton("QUITTER", { rightIcon = "chevron" }, {
                    onSelected = function()
                        tpIPL = false
                        SetPedCoordsKeepVehicle(VFW.PlayerData.ped, lastPos.x, lastPos.y, lastPos.z)
                        StaffMenu.BuildEventsIplSelectMenu()
                    end
                })
            end
        end
    end)
end

function StaffMenu.BuildMapEditorMenu()
    xmenu.items(StaffMenu.mapeditor, function()
        addCheckbox("FREEZE LE PROCHAIN OBJET", freezObject, {}, {
            onChange = function(checked)
                freezObject = checked
            end
        })

        addButton("PLACER UN OBJET", { rightIcon = "chevron" }, {
            onSelected = function()
                local object = VFW.Nui.KeyboardInput(true, "Nom du props (forge.plebmasters.de/objects)", "")

                SpawnProps(object, freezObject)
            end
        })

        addButton("OBJETS PLACÃ‰S", { rightIcon = "chevron" }, {
            onSelected = function()
                StaffMenu.BuildMapEditorObjectList()
            end
        }, StaffMenu.objectListPlaced)

        addButton("SUPPRIMER TOUS LES OBJETS", { rightIcon = "chevron" }, {
            onSelected = function()
                local placedPropsEvent = TriggerServerCallback("vfw:staff:getObject")

                for k, v in pairs(placedPropsEvent) do
                    if DoesEntityExist(v.id) then
                        VFW.Game.DeleteObject(v.id)
                        TriggerServerEvent("vfw:staff:deleteObject", k)
                    end
                end
            end
        })
    end)
end

function StaffMenu.BuildMapEditorObjectList()
    xmenu.items(StaffMenu.objectListPlaced, function()
        local placedPropsEvent = TriggerServerCallback("vfw:staff:getObject")

        for k, v in pairs(placedPropsEvent) do
            addButton(string.upper(v.name), { rightIcon = "chevron" }, {
                onSelected = function()
                    if DoesEntityExist(v.id) then
                        VFW.Game.DeleteObject(v.id)
                        TriggerServerEvent("vfw:staff:deleteObject", k)
                        StaffMenu.BuildMapEditorObjectList()
                    end
                end
            })
        end
    end)
end
